package worms.model;

public class StatementAction extends Statement {
	
	private final StatementAction.ActionTypes actionType;
	
	public StatementAction.ActionTypes getActionType() {
		return actionType;
	}

	public StatementAction(StatementAction.ActionTypes type) {
		super(new Statement[0], new Expression[0]);
		this.actionType = type;
	}
	
	public StatementAction( StatementAction.ActionTypes type, Expression e ) {
		super(new Statement[0], new Expression[] {e});
		this.actionType = type;
	}
	
	public static enum ActionTypes {
		TURN,
		MOVE,
		JUMP,
		TOGGLEWEAP,
		FIRE,
		SKIP
	}

	@Override
	public void execute() {
		Statement statement = this;
		while ( statement.hasAParentStatement() ) {
			statement = statement.getParentStatement();
		}
		Program program = statement.getProgram();
		Worm worm = program.getWorm();
		
		if ( getActionType() == StatementAction.ActionTypes.TURN ) {
			if ( !(getExpressions().get(0).evaluate().getValue() instanceof Number) )
				program.typeErrorOccurred();
			worm.turn((double)getExpressions().get(0).evaluate().getValue());
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.MOVE ) {
			worm.move();
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.JUMP ) {
			worm.jump(); //TODO what timestep?
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.TOGGLEWEAP ) {
			worm.equipNextWeapon();
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.FIRE ) {
			if ( !(getExpressions().get(0).evaluate().getValue() instanceof Number) )
				program.typeErrorOccurred();
			worm.shoot((double)getExpressions().get(0).evaluate().getValue());
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.SKIP ) {
			// do nothing
			return;
		}
		program.typeErrorOccurred();

	}

	@Override
	public boolean containsActionStatement() {
		return true;
	}

}
