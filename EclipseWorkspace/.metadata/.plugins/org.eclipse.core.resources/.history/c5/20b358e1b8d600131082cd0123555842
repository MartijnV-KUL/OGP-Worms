package worms.model;

import worms.gui.GUIConstants;

public class StatementAction extends Statement {
	
	private final StatementAction.ActionTypes actionType;
	
	public StatementAction.ActionTypes getActionType() {
		return actionType;
	}

	public StatementAction(int line, int column, StatementAction.ActionTypes type) {
		super(line, column, new Statement[0], new Expression[0]);
		this.actionType = type;
	}
	
	public StatementAction( int line, int column, StatementAction.ActionTypes type, Expression e ) {
		super(line, column, new Statement[0], new Expression[] {e});
		this.actionType = type;
	}
	
	public static enum ActionTypes {
		TURN,
		MOVE,
		JUMP,
		TOGGLEWEAP,
		FIRE,
		SKIP
	}

	@Override
	public void execute() {
		super.execute();
		Program program = getRootProgram();
		Worm worm = program.getWorm();
		
		if ( getActionType() == StatementAction.ActionTypes.TURN ) {
			if ( !(getExpressions().get(0).evaluate().getValue() instanceof Number) )
				program.typeErrorOccurred();
			if ( !worm.canTurn((double)((Type<Double>)getExpressions().get(0).evaluate()).getValue()) )
				program.stopProgram();
			worm.turn((double)((Type<Double>)getExpressions().get(0).evaluate()).getValue());
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.MOVE ) {
			if ( !worm.canMove() )
				program.stopProgram();
			worm.move();
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.JUMP ) {
			if ( !worm.canJump() )
				program.stopProgram();
			worm.jump();
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.TOGGLEWEAP ) {
			if ( !worm.canMove() )
				program.stopProgram();
			worm.equipNextWeapon();
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.FIRE ) {
			if ( !worm.canShoot() )
				program.stopProgram();
			if ( !(getExpressions().get(0).evaluate().getValue() instanceof Number) )
				program.typeErrorOccurred();
			worm.shoot((int)Math.floor(((Type<Double>)getExpressions().get(0).evaluate()).getValue()));
			return;
		}
		if ( getActionType() == StatementAction.ActionTypes.SKIP ) {
			// do nothing
			return;
		}
		program.typeErrorOccurred();

	}

	@Override
	public boolean containsActionStatement() {
		return true;
	}

}
