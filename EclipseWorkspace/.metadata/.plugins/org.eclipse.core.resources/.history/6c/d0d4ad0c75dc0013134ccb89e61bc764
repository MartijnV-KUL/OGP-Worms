package worms.model;


public class ExpressionsSingular extends Expression {

	public ExpressionsSingular(int line, int column, Expression e) {
		super(line,column,e);
	}

	public Type<?> evaluate() {
		if (getType()==Expression.Types.SEARCHOBJ) {
			double x = getStatement().getRootProgram().getWorm().getX();
			double y = getStatement().getRootProgram().getWorm().getY();
			double angle = getStatement().getRootProgram().getWorm().getDirection() + ((double)((Type<Double>)e.evaluate()).getValue());
			double resolution = 0.1*getStatement().getRootProgram().getWorm().getRadius();
			while ( getStatement().getRootProgram().getWorm().getWorld().isWithinBoundaries(x,y) ) {
				for ( Worm worm : getStatement().getRootProgram().getWorm().getWorld().getAliveWorms() ) {
					if ( World.isOverlapping(worm.getX(), worm.getY(), worm.getRadius(), x, y, 0) )
						return new Type<Entity>(new Entity(worm));
					x = x + resolution*Math.cos(angle);
					y = y + resolution*Math.sin(angle);
				}
			}
			return new Type<Entity>();
		}
		if (getType()==Expression.Types.ISWORM)
			return new Type<Boolean>(e.evaluate().getValue() instanceof Worm);
		if (getType()==Expression.Types.ISFOOD)
			return new Type<Boolean>(e.evaluate().getValue() instanceof Food);

		getStatement().getRootProgram().typeErrorOccurred();
		return null;
	}
	
}
